<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Penjana Gesaan untuk Siasatan</title>
  <style>
    #app {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      font-family: Arial, sans-serif;
    }
    h1, h2, h3 {
      color: #333;
    }
    .subject, .detail {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 10px;
      background-color: #f9f9f9;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    select, input[type="text"] {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    button {
      padding: 8px 16px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
    }
    button:hover {
      background-color: #0056b3;
    }
    #generated-prompt pre {
      background-color: #f8f9fa;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
      white-space: pre-wrap;
      font-family: 'Courier New', Courier, monospace;
    }
    #message {
      margin-top: 10px;
      padding: 10px;
      border-radius: 4px;
    }
    #message.success {
      background-color: #d4edda;
      color: #155724;
    }
    #message.error {
      background-color: #f8d7da;
      color: #721c24;
    }
  </style>
</head>
<body>
  <div id="app">
    <h1>Penjana Gesaan untuk Siasatan</h1>
    <p>Dibina untuk Gemini Pro</p>

    <!-- Pilihan Utama -->
    <div id="main-options">
      <div>
        <label>Jenis Siasatan</label>
        <select id="jenisSiasatan">
          <option value="">Pilih...</option>
          <option>Kuantitatif</option>
          <option>Kualitatif</option>
          <option>Kaedah Campuran</option>
        </select>
      </div>
      <div>
        <label>Tujuan Utama Siasatan</label>
        <select id="tujuanUtamaSiasatan">
          <option value="">Pilih...</option>
          <option>Membongkar Fakta Kes Jenayah</option>
          <option>Penyelidikan Kewartawanan Mendalam</option>
          <option>Analisis Risikan</option>
          <option>Pemeriksaan Latar Belakang (Background Check)</option>
          <option>Kajian Kes Akademik</option>
          <option>Lain-lain (Tulis Sendiri)</option>
        </select>
        <input type="text" id="customTujuanUtamaSiasatan" style="display: none;" placeholder="Tulis tujuan anda...">
      </div>
      <div>
        <label>Jenis Maklumat yang Dicari</label>
        <select id="jenisMaklumat">
          <option value="">Pilih...</option>
          <option>Alibi dan Garis Masa Kejadian</option>
          <option>Motif Pelaku/Subjek</option>
          <option>Hubungan Antara Individu/Entiti</option>
          <option>Analisis Bukti Fizikal dan Digital</option>
          <option>Pemeriksaan Laporan Kewangan</option>
          <option>Mengenal Pasti Corak Tingkah Laku</option>
          <option>Lain-lain (Tulis Sendiri)</option>
        </select>
        <input type="text" id="customJenisMaklumat" style="display: none;" placeholder="Tulis jenis maklumat...">
      </div>
      <div>
        <label>Sumber Maklumat Utama</label>
        <select id="sumberMaklumat">
          <option value="">Pilih...</option>
          <option>Temu Bual Saksi/Subjek</option>
          <option>Dokumen Rasmi (Laporan Polis, Mahkamah)</option>
          <option>Jejak Digital (Media Sosial, E-mel)</option>
          <option>Laporan Kewangan/Perbankan</option>
          <option>Rakaman CCTV/Audio</option>
          <option>Data Risikan Sumber Terbuka (OSINT)</option>
          <option>Lain-lain (Tulis Sendiri)</option>
        </select>
        <input type="text" id="customSumberMaklumat" style="display: none;" placeholder="Tulis sumber maklumat...">
      </div>
      <div>
        <label>Gaya Bahasa dan Nada</label>
        <select id="gayaBahasaNada">
          <option value="">Pilih...</option>
          <option>Formal dan Objektif</option>
          <option>Interogatif dan Menyelidik</option>
          <option>Analitikal dan Kritis</option>
          <option>Naratif dan Deskriptif</option>
          <option>Persuasif (untuk laporan)</option>
          <option>Lain-lain (Tulis Sendiri)</option>
        </select>
        <input type="text" id="customGayaBahasaNada" style="display: none;" placeholder="Tulis gaya bahasa...">
      </div>
      <div>
        <label>Struktur Analisis/Gesaan</label>
        <select id="strukturGesaan">
          <option value="">Pilih...</option>
          <option>Soalan 5W+1H (Siapa, Apa, Bila, Di Mana, Mengapa, Bagaimana)</option>
          <option>Analisis Kronologi Kejadian</option>
          <option>Analisis Rangkaian dan Hubungan</option>
          <option>Pembinaan dan Pengujian Hipotesis</option>
          <option>Mengenal Pasti Kejanggalan dan Ketidakselarasan</option>
          <option>Lain-lain (Tulis Sendiri)</option>
        </select>
        <input type="text" id="customStrukturGesaan" style="display: none;" placeholder="Tulis struktur...">
      </div>
      <div>
        <label>Format Output yang Diingini</label>
        <select id="formatOutput">
          <option value="">Pilih...</option>
          <option>Ringkasan Laporan Siasatan</option>
          <option>Senarai Soalan untuk Temu Bual</option>
          <option>Garis Masa Kejadian Terperinci</option>
          <option>Analisis Profil Subjek/Entiti</option>
          <option>Draf Artikel Kewartawanan</option>
          <option>Isi-isi Penting untuk Pembentangan</option>
          <option>Lain-lain (Tulis Sendiri)</option>
        </select>
        <input type="text" id="customFormatOutput" style="display: none;" placeholder="Tulis format output...">
      </div>
    </div>

    <!-- Subjek/Entiti Siasatan -->
    <div id="subjects">
      <h2>Subjek/Entiti Siasatan</h2>
      <button id="add-subject">Tambah Subjek</button>
    </div>

    <!-- Butiran Penting -->
    <div id="important-details">
      <h2>Butiran Penting atau Arahan Khusus</h2>
      <button id="add-detail">Tambah Butiran Penting</button>
    </div>

    <!-- Tindakan -->
    <div id="actions">
      <button id="generate-prompt">Jana Gesaan Siasatan</button>
      <button id="copy-prompt">Salin Gesaan</button>
    </div>

    <!-- Mesej -->
    <div id="message"></div>

    <!-- Gesaan yang Dijana -->
    <div id="generated-prompt">
      <h2>Gesaan yang Dijana:</h2>
      <pre></pre>
    </div>
  </div>

  <script>
    // Objek keadaan
    const state = {
      jenisSiasatan: '',
      tujuanUtamaSiasatan: '',
      customTujuanUtamaSiasatan: '',
      jenisMaklumat: '',
      customJenisMaklumat: '',
      sumberMaklumat: '',
      customSumberMaklumat: '',
      gayaBahasaNada: '',
      customGayaBahasaNada: '',
      strukturGesaan: '',
      customStrukturGesaan: '',
      formatOutput: '',
      customFormatOutput: '',
      subjekSiasatan: [],
      butiranPenting: [],
      generatedPrompt: '',
      message: ''
    };

    let subjectId = 1;
    let detailId = 1;

    // Fungsi untuk mencipta div subjek
    function createSubjectDiv(id) {
      const div = document.createElement('div');
      div.className = 'subject';
      div.dataset.id = id;
      const h3 = document.createElement('h3');
      h3.textContent = `Subjek ${id}`;
      const deleteButton = document.createElement('button');
      deleteButton.textContent = 'Padam';
      deleteButton.addEventListener('click', () => removeSubject(id));
      const namaLabel = document.createElement('label');
      namaLabel.textContent = 'Nama';
      const namaInput = document.createElement('input');
      namaInput.type = 'text';
      namaInput.addEventListener('input', (e) => updateSubject(id, 'nama', e.target.value));
      const perananLabel = document.createElement('label');
      perananLabel.textContent = 'Peranan';
      const perananSelect = document.createElement('select');
      perananSelect.innerHTML = `
        <option value="">Pilih...</option>
        <option>Suspek</option>
        <option>Saksi</option>
        <option>Mangsa</option>
        <option>Orang yang Disiasat</option>
        <option>Sumber Maklumat</option>
        <option>Lain-lain (Tulis Sendiri)</option>
      `;
      perananSelect.addEventListener('change', (e) => updateSubject(id, 'peranan', e.target.value));
      const customPerananInput = document.createElement('input');
      customPerananInput.type = 'text';
      customPerananInput.style.display = 'none';
      customPerananInput.placeholder = 'Tulis peranan anda...';
      customPerananInput.addEventListener('input', (e) => updateSubject(id, 'customPeranan', e.target.value));
      perananSelect.addEventListener('change', (e) => {
        if (e.target.value === 'Lain-lain (Tulis Sendiri)') {
          customPerananInput.style.display = 'block';
        } else {
          customPerananInput.style.display = 'none';
          updateSubject(id, 'customPeranan', '');
        }
      });
      const latarBelakangLabel = document.createElement('label');
      latarBelakangLabel.textContent = 'Latar Belakang';
      const latarBelakangInput = document.createElement('input');
      latarBelakangInput.type = 'text';
      latarBelakangInput.addEventListener('input', (e) => updateSubject(id, 'latarBelakang', e.target.value));
      div.appendChild(h3);
      div.appendChild(deleteButton);
      div.appendChild(namaLabel);
      div.appendChild(namaInput);
      div.appendChild(perananLabel);
      div.appendChild(perananSelect);
      div.appendChild(customPerananInput);
      div.appendChild(latarBelakangLabel);
      div.appendChild(latarBelakangInput);
      return div;
    }

    // Fungsi untuk menambah subjek
    function addSubject() {
      const id = subjectId++;
      state.subjekSiasatan.push({ id, nama: '', peranan: '', customPeranan: '', latarBelakang: '' });
      const subjectDiv = createSubjectDiv(id);
      const subjectsDiv = document.getElementById('subjects');
      const addButton = document.getElementById('add-subject');
      subjectsDiv.insertBefore(subjectDiv, addButton);
    }

    // Fungsi untuk memadam subjek
    function removeSubject(id) {
      state.subjekSiasatan = state.subjekSiasatan.filter(subjek => subjek.id !== id);
      const subjectDiv = document.querySelector(`.subject[data-id="${id}"]`);
      subjectDiv.remove();
    }

    // Fungsi untuk mengemas kini subjek
    function updateSubject(id, field, value) {
      const subjek = state.subjekSiasatan.find(s => s.id === id);
      if (subjek) {
        subjek[field] = value;
      }
    }

    // Fungsi untuk mencipta div butiran penting
    function createDetailDiv(id) {
      const div = document.createElement('div');
      div.className = 'detail';
      div.dataset.id = id;
      const select = document.createElement('select');
      select.innerHTML = `
        <option value="">Pilih...</option>
        <option>Fokus pada hubungan kewangan antara subjek A dan B</option>
        <option>Cari kemungkinan wujudnya alibi palsu</option>
        <option>Analisis hantaran media sosial dalam 3 bulan terakhir</option>
        <option>Mengenal pasti kemungkinan motif balas dendam</option>
        <option>Bandingkan keterangan saksi A dan saksi B</option>
        <option>Lain-lain (Tulis Sendiri)</option>
      `;
      select.addEventListener('change', (e) => updateDetail(id, 'value', e.target.value));
      const customInput = document.createElement('input');
      customInput.type = 'text';
      customInput.style.display = 'none';
      customInput.placeholder = 'Tulis butiran anda...';
      customInput.addEventListener('input', (e) => updateDetail(id, 'custom', e.target.value));
      select.addEventListener('change', (e) => {
        if (e.target.value === 'Lain-lain (Tulis Sendiri)') {
          customInput.style.display = 'block';
        } else {
          customInput.style.display = 'none';
          updateDetail(id, 'custom', '');
        }
      });
      const deleteButton = document.createElement('button');
      deleteButton.textContent = 'Padam';
      deleteButton.addEventListener('click', () => removeDetail(id));
      div.appendChild(select);
      div.appendChild(customInput);
      div.appendChild(deleteButton);
      return div;
    }

    // Fungsi untuk menambah butiran penting
    function addDetail() {
      const id = detailId++;
      state.butiranPenting.push({ id, value: '', custom: '' });
      const detailDiv = createDetailDiv(id);
      const detailsDiv = document.getElementById('important-details');
      const addButton = document.getElementById('add-detail');
      detailsDiv.insertBefore(detailDiv, addButton);
    }

    // Fungsi untuk memadam butiran penting
    function removeDetail(id) {
      state.butiranPenting = state.butiranPenting.filter(detail => detail.id !== id);
      const detailDiv = document.querySelector(`.detail[data-id="${id}"]`);
      detailDiv.remove();
    }

    // Fungsi untuk mengemas kini butiran penting
    function updateDetail(id, field, value) {
      const detail = state.butiranPenting.find(d => d.id === id);
      if (detail) {
        detail[field] = value;
      }
    }

    // Senarai pilihan dengan input tersuai
    const selectsWithCustom = [
      'tujuanUtamaSiasatan',
      'jenisMaklumat',
      'sumberMaklumat',
      'gayaBahasaNada',
      'strukturGesaan',
      'formatOutput'
    ];

    // Menyediakan pengendali peristiwa untuk pilihan utama
    document.getElementById('jenisSiasatan').addEventListener('change', (e) => {
      state.jenisSiasatan = e.target.value;
    });

    selectsWithCustom.forEach(field => {
      const select = document.getElementById(field);
      const customInput = document.getElementById(`custom${field.charAt(0).toUpperCase() + field.slice(1)}`);
      select.addEventListener('change', (e) => {
        state[field] = e.target.value;
        if (e.target.value === 'Lain-lain (Tulis Sendiri)') {
          customInput.style.display = 'block';
        } else {
          customInput.style.display = 'none';
          state[`custom${field.charAt(0).toUpperCase() + field.slice(1)}`] = '';
        }
      });
      customInput.addEventListener('input', (e) => {
        state[`custom${field.charAt(0).toUpperCase() + field.slice(1)}`] = e.target.value;
      });
    });

    // Fungsi untuk menjana teks gesaan
    function generatePromptText() {
      const parts = [];

      const getValue = (field) => {
        const selectedValue = state[field];
        if (field === 'jenisSiasatan') {
          return selectedValue;
        }
        const customValue = state[`custom${field.charAt(0).toUpperCase() + field.slice(1)}`];
        return selectedValue === 'Lain-lain (Tulis Sendiri)' ? customValue : selectedValue;
      };

      const getRepeatableValues = (field) => {
        return state[field]
          .map(item => (item.value === 'Lain-lain (Tulis Sendiri)' ? item.custom : item.value))
          .filter(Boolean);
      };

      const getSubjekDetails = (subjek) => {
        const details = [];
        if (subjek.nama) details.push(`Nama: ${subjek.nama}`);
        if (subjek.peranan) {
          const peranan = subjek.peranan === 'Lain-lain (Tulis Sendiri)' ? subjek.customPeranan : subjek.peranan;
          details.push(`Peranan: ${peranan}`);
        }
        if (subjek.latarBelakang) details.push(`Latar Belakang: ${subjek.latarBelakang}`);
        return details.join(', ');
      };

      parts.push("Anda ialah seorang pembantu siasatan AI yang pakar. Berdasarkan maklumat berikut, jana output yang diminta.");
      parts.push("---");

      const appendIfPresent = (label, value) => {
        if (value && value !== 'Pilih...') parts.push(`**${label}:** ${value}`);
      };

      appendIfPresent('Jenis Siasatan', getValue('jenisSiasatan'));
      appendIfPresent('Tujuan Utama Siasatan', getValue('tujuanUtamaSiasatan'));
      appendIfPresent('Jenis Maklumat yang Dicari', getValue('jenisMaklumat'));
      appendIfPresent('Sumber Maklumat Utama', getValue('sumberMaklumat'));
      appendIfPresent('Gaya Bahasa dan Nada', getValue('gayaBahasaNada'));
      appendIfPresent('Struktur Analisis/Gesaan', getValue('strukturGesaan'));
      appendIfPresent('Format Output yang Diingini', getValue('formatOutput'));

      if (state.subjekSiasatan.length > 0) {
        parts.push("\n**Subjek/Entiti Utama:**");
        state.subjekSiasatan.forEach((subjek, index) => {
          const details = getSubjekDetails(subjek);
          if (details) parts.push(`- Subjek ${index + 1}: ${details}`);
        });
      }

      const butiranPentingValues = getRepeatableValues('butiranPenting');
      if (butiranPentingValues.length > 0) {
        parts.push("\n**Butiran Penting atau Arahan Khusus:**");
        butiranPentingValues.forEach(detail => parts.push(`- ${detail}`));
      }

      parts.push("\n---");
      parts.push("Sila proses permintaan ini secara komprehensif dan terperinci.");

      return parts.filter(Boolean).join('\n');
    }

    // Pengendali peristiwa untuk butang
    document.getElementById('add-subject').addEventListener('click', addSubject);
    document.getElementById('add-detail').addEventListener('click', addDetail);

    document.getElementById('generate-prompt').addEventListener('click', () => {
      const prompt = generatePromptText();
      state.generatedPrompt = prompt;
      document.querySelector('#generated-prompt pre').textContent = prompt;
      state.message = 'Gesaan berjaya dijana!';
      const messageDiv = document.getElementById('message');
      messageDiv.textContent = state.message;
      messageDiv.className = 'success';
    });

    document.getElementById('copy-prompt').addEventListener('click', () => {
      if (!state.generatedPrompt) {
        state.message = 'Tiada gesaan untuk disalin. Sila jana gesaan terlebih dahulu.';
        const messageDiv = document.getElementById('message');
        messageDiv.textContent = state.message;
        messageDiv.className = 'error';
        return;
      }
      try {
        const textarea = document.createElement('textarea');
        textarea.value = state.generatedPrompt;
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        state.message = 'Gesaan berjaya disalin ke papan keratan!';
        const messageDiv = document.getElementById('message');
        messageDiv.textContent = state.message;
        messageDiv.className = 'success';
      } catch (err) {
        console.error('Gagal menyalin: ', err);
        state.message = 'Gagal menyalin gesaan.';
        const messageDiv = document.getElementById('message');
        messageDiv.textContent = state.message;
        messageDiv.className = 'error';
      }
    });

    // Inisialisasi dengan satu subjek dan satu butiran penting
    window.addEventListener('load', () => {
      addSubject();
      addDetail();
    });
  </script>
</body>
</html>
